<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title data-i18n="booking.detail.title">予約詳細 - セキュレアシティ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/custom.css">
  
  <script>
    // 翻訳データ（Gemini方式：埋め込み型）
    window.i18nData = {
      ja: {
        // 共通
        'home': 'ホーム',
        'board': '掲示板',
        'booking': '予約',
        'mypage': 'マイページ',
        'back': '戻る',
        'cancel': 'キャンセル',
        'edit': '編集',
        
        // 予約詳細画面
        'booking.detail.title': '予約詳細',
        'booking.detail.info': '予約情報',
        'booking.detail.facility': '施設',
        'booking.detail.date': '予約日',
        'booking.detail.time': '利用時間',
        'booking.detail.purpose': '使用目的',
        'booking.detail.attendees': '参加人数',
        'booking.detail.status': 'ステータス',
        'booking.detail.created': '予約日時',
        'booking.detail.edit_button': '予約を変更',
        'booking.detail.cancel_button': 'この予約をキャンセル',
        
        // ステータス
        'booking.status.active': '予約確定',
        'booking.status.cancelled': 'キャンセル済み',
        'booking.status.completed': '利用完了',
        
        // 施設名
        'booking.hall.name_short': '集会所（セキュレアステーション）',
        'booking.parking.name_short': 'ゲスト駐車場',
        'booking.parking.spot': '番',
        
        // 時間
        'booking.history.allday': '終日（24時間）',
        
        // アラート
        'booking.detail.cancel_confirm': 'この予約をキャンセルしますか？\n\nキャンセル後は元に戻せません。',
        'booking.detail.cancel_success': '予約をキャンセルしました',
        
        // その他
        'booking.detail.people': '名',
        'booking.detail.no_purpose': '（未入力）'
      },
      en: {
        // 共通
        'home': 'Home',
        'board': 'Board',
        'booking': 'Booking',
        'mypage': 'My Page',
        'back': 'Back',
        'cancel': 'Cancel',
        'edit': 'Edit',
        
        // 予約詳細画面
        'booking.detail.title': 'Booking Details',
        'booking.detail.info': 'Booking Information',
        'booking.detail.facility': 'Facility',
        'booking.detail.date': 'Date',
        'booking.detail.time': 'Time',
        'booking.detail.purpose': 'Purpose',
        'booking.detail.attendees': 'Attendees',
        'booking.detail.status': 'Status',
        'booking.detail.created': 'Booked on',
        'booking.detail.edit_button': 'Edit Booking',
        'booking.detail.cancel_button': 'Cancel This Booking',
        
        // ステータス
        'booking.status.active': 'Confirmed',
        'booking.status.cancelled': 'Cancelled',
        'booking.status.completed': 'Completed',
        
        // 施設名
        'booking.hall.name_short': 'Meeting Room (SECUREA Station)',
        'booking.parking.name_short': 'Guest Parking',
        'booking.parking.spot': ' Spot',
        
        // 時間
        'booking.history.allday': 'All day (24 hours)',
        
        // アラート
        'booking.detail.cancel_confirm': 'Cancel this booking?\n\nThis action cannot be undone.',
        'booking.detail.cancel_success': 'Booking cancelled',
        
        // その他
        'booking.detail.people': ' people',
        'booking.detail.no_purpose': '(Not entered)'
      },
      zh: {
        // 共通
        'home': '首页',
        'board': '留言板',
        'booking': '预约',
        'mypage': '我的',
        'back': '返回',
        'cancel': '取消',
        'edit': '编辑',
        
        // 予約詳細画面
        'booking.detail.title': '预约详情',
        'booking.detail.info': '预约信息',
        'booking.detail.facility': '设施',
        'booking.detail.date': '预约日期',
        'booking.detail.time': '使用时间',
        'booking.detail.purpose': '使用目的',
        'booking.detail.attendees': '参加人数',
        'booking.detail.status': '状态',
        'booking.detail.created': '预约时间',
        'booking.detail.edit_button': '更改预约',
        'booking.detail.cancel_button': '取消此预约',
        
        // ステータス
        'booking.status.active': '预约确认',
        'booking.status.cancelled': '已取消',
        'booking.status.completed': '已完成',
        
        // 施設名
        'booking.hall.name_short': '会议室（SECUREA Station）',
        'booking.parking.name_short': '访客停车场',
        'booking.parking.spot': '号',
        
        // 時間
        'booking.history.allday': '全天（24小时）',
        
        // アラート
        'booking.detail.cancel_confirm': '取消此预约吗？\n\n取消后无法恢复。',
        'booking.detail.cancel_success': '预约已取消',
        
        // その他
        'booking.detail.people': '人',
        'booking.detail.no_purpose': '（未输入）'
      }
    };
    console.log('✅ i18nData embedded for booking-detail.html');
  </script>
</head>
<body class="bg-gray-50">
  <!-- 言語切り替えボタン -->
  <div class="fixed top-4 right-4 language-switcher z-50 shadow-lg">
    <button class="lang-btn" data-lang="ja">JA</button>
    <button class="lang-btn" data-lang="en">EN</button>
    <button class="lang-btn" data-lang="zh">ZH</button>
  </div>

  <!-- ヘッダー -->
  <header class="bg-white shadow-sm">
    <div class="max-w-4xl mx-auto px-4 py-4">
      <div class="flex items-center gap-3">
        <button onclick="window.location.href='booking-history.html'" class="text-gray-600 hover:text-gray-900">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
          </svg>
        </button>
        <h1 class="text-xl font-bold text-gray-900" data-i18n="booking.detail.title">予約詳細</h1>
      </div>
    </div>
  </header>

  <!-- メインコンテンツ -->
  <main class="max-w-4xl mx-auto px-4 py-6 pb-32">
    
    <!-- 予約情報カード -->
    <div class="bg-white rounded-lg shadow-sm p-6 mb-6 fade-in">
      <h2 class="text-lg font-bold text-gray-900 mb-4" data-i18n="booking.detail.info">予約情報</h2>
      
      <div class="space-y-4">
        <!-- 施設 -->
        <div class="flex items-start gap-3 pb-4 border-b border-gray-100">
          <div class="bg-blue-100 rounded-lg p-2">
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
            </svg>
          </div>
          <div class="flex-1">
            <div class="text-sm text-gray-600 mb-1" data-i18n="booking.detail.facility">施設</div>
            <div id="facilityName" class="text-lg font-bold text-gray-900">...</div>
          </div>
        </div>

        <!-- 予約日 -->
        <div class="flex items-start gap-3 pb-4 border-b border-gray-100">
          <div class="bg-blue-100 rounded-lg p-2">
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="flex-1">
            <div class="text-sm text-gray-600 mb-1" data-i18n="booking.detail.date">予約日</div>
            <div id="bookingDate" class="text-lg font-bold text-gray-900">...</div>
          </div>
        </div>

        <!-- 利用時間 -->
        <div class="flex items-start gap-3 pb-4 border-b border-gray-100">
          <div class="bg-blue-100 rounded-lg p-2">
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="flex-1">
            <div class="text-sm text-gray-600 mb-1" data-i18n="booking.detail.time">利用時間</div>
            <div id="bookingTime" class="text-lg font-bold text-gray-900">...</div>
          </div>
        </div>

        <!-- 使用目的（集会所のみ） -->
        <div id="purposeSection" class="flex items-start gap-3 pb-4 border-b border-gray-100" style="display:none;">
          <div class="bg-blue-100 rounded-lg p-2">
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
              <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm3 4a1 1 0 000 2h.01a1 1 0 100-2H7zm3 0a1 1 0 000 2h3a1 1 0 100-2h-3zm-3 4a1 1 0 100 2h.01a1 1 0 100-2H7zm3 0a1 1 0 100 2h3a1 1 0 100-2h-3z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="flex-1">
            <div class="text-sm text-gray-600 mb-1" data-i18n="booking.detail.purpose">使用目的</div>
            <div id="bookingPurpose" class="text-lg font-bold text-gray-900">...</div>
          </div>
        </div>

        <!-- 参加人数（集会所のみ） -->
        <div id="attendeesSection" class="flex items-start gap-3 pb-4 border-b border-gray-100" style="display:none;">
          <div class="bg-blue-100 rounded-lg p-2">
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
            </svg>
          </div>
          <div class="flex-1">
            <div class="text-sm text-gray-600 mb-1" data-i18n="booking.detail.attendees">参加人数</div>
            <div id="bookingAttendees" class="text-lg font-bold text-gray-900">...</div>
          </div>
        </div>

        <!-- ステータス -->
        <div class="flex items-start gap-3 pb-4 border-b border-gray-100">
          <div class="bg-blue-100 rounded-lg p-2">
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="flex-1">
            <div class="text-sm text-gray-600 mb-1" data-i18n="booking.detail.status">ステータス</div>
            <div id="bookingStatus" class="text-lg font-bold">...</div>
          </div>
        </div>

        <!-- 予約日時 -->
        <div class="flex items-start gap-3">
          <div class="bg-blue-100 rounded-lg p-2">
            <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div class="flex-1">
            <div class="text-sm text-gray-600 mb-1" data-i18n="booking.detail.created">予約日時</div>
            <div id="bookingCreated" class="text-lg font-bold text-gray-900">...</div>
          </div>
        </div>
      </div>
    </div>

    <!-- アクションボタン -->
    <div id="actionButtons" class="space-y-3 fade-in">
      <button 
        onclick="editBooking()" 
        class="w-full bg-blue-600 text-white py-4 rounded-lg font-bold hover:bg-blue-700 transition flex items-center justify-center gap-2"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"/>
        </svg>
        <span data-i18n="booking.detail.edit_button">予約を変更</span>
      </button>
      
      <button 
        onclick="cancelBooking()" 
        class="w-full bg-red-50 text-red-600 py-4 rounded-lg font-bold hover:bg-red-100 transition border-2 border-red-200"
      >
        <span data-i18n="booking.detail.cancel_button">この予約をキャンセル</span>
      </button>
    </div>

  </main>

  <!-- ナビゲーションバー -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-lg">
    <div class="max-w-4xl mx-auto px-4">
      <div class="flex justify-around py-3">
        <a href="home.html" class="flex flex-col items-center text-gray-500">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
          </svg>
          <span class="text-xs mt-1" data-i18n="home">ホーム</span>
        </a>
        <a href="board.html" class="flex flex-col items-center text-gray-500">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
          </svg>
          <span class="text-xs mt-1" data-i18n="board">掲示板</span>
        </a>
        <a href="booking.html" class="flex flex-col items-center text-gray-500">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
          </svg>
          <span class="text-xs mt-1" data-i18n="booking">予約</span>
        </a>
        <a href="mypage.html" class="flex flex-col items-center text-blue-600">
          <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20">
            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
          </svg>
          <span class="text-xs mt-1 font-bold" data-i18n="mypage">マイページ</span>
        </a>
      </div>
    </div>
  </nav>

  <!-- 翻訳システム（Gemini方式：埋め込み型） -->
  <script>
    class EmbeddedLanguageManager {
      constructor() {
        this.currentLanguage = localStorage.getItem('language') || 'ja';
        this.translations = window.i18nData;
        this.dynamicHooks = [];
      }
      
      setLanguage(lang) {
        if (this.translations[lang]) {
          this.currentLanguage = lang;
          localStorage.setItem('language', lang);
          this.updatePage();
          this.updateLanguageButtons();
          this.dynamicHooks.forEach(hook => hook());
        }
      }
      
      translate(key) {
        const translation = this.translations[this.currentLanguage];
        return translation && translation[key] ? translation[key] : key;
      }
      
      updatePage() {
        document.querySelectorAll('[data-i18n]').forEach(element => {
          const key = element.getAttribute('data-i18n');
          const translation = this.translate(key);
          
          if (element.children.length === 0) {
            element.textContent = translation;
          } else {
            for (let node of element.childNodes) {
              if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) {
                node.textContent = translation;
                break;
              }
            }
          }
        });
        
        const titleElement = document.querySelector('title[data-i18n]');
        if (titleElement) {
          const key = titleElement.getAttribute('data-i18n');
          document.title = this.translate(key);
        }
      }
      
      updateLanguageButtons() {
        document.querySelectorAll('.lang-btn').forEach(btn => {
          const lang = btn.getAttribute('data-lang');
          if (lang === this.currentLanguage) {
            btn.classList.add('active');
            btn.classList.remove('inactive');
          } else {
            btn.classList.remove('active');
            btn.classList.add('inactive');
          }
        });
      }
      
      init() {
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            this.setLanguage(lang);
          });
        });
      }
      
      getCurrentLanguage() {
        return this.currentLanguage;
      }
    }
    
    window.languageManager = new EmbeddedLanguageManager();
    window.i18n = function(key) {
      return window.languageManager.translate(key);
    };
  </script>

  <!-- 予約詳細のロジック -->
  <script>
    let currentBookingId = null;

    // URLから予約IDを取得
    function getBookingIdFromUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      return parseInt(urlParams.get('id'));
    }

    // LocalStorageから予約データを取得
    function getBooking(bookingId) {
      const bookingsJson = localStorage.getItem('bookings');
      if (!bookingsJson) return null;
      
      const bookings = JSON.parse(bookingsJson);
      return bookings.find(b => b.id === bookingId);
    }

    // 予約詳細を表示
    function renderBookingDetail() {
      currentBookingId = getBookingIdFromUrl();
      const booking = getBooking(currentBookingId);
      
      if (!booking) {
        alert('予約が見つかりませんでした');
        window.location.href = 'booking-history.html';
        return;
      }

      // 施設名
      let facilityName;
      if (booking.facility === 'hall') {
        facilityName = window.i18n('booking.hall.name_short');
      } else {
        const parkingName = window.i18n('booking.parking.name_short');
        const spotUnit = window.i18n('booking.parking.spot');
        facilityName = `${parkingName} ${booking.parkingNum}${spotUnit}`;
      }
      document.getElementById('facilityName').textContent = facilityName;

      // 予約日
      document.getElementById('bookingDate').textContent = booking.date.replace(/-/g, '/');

      // 利用時間
      let timeText;
      if (booking.time === 'allday') {
        timeText = window.i18n('booking.history.allday');
      } else {
        timeText = booking.time;
      }
      document.getElementById('bookingTime').textContent = timeText;

      // 使用目的・参加人数（集会所のみ）
      const purposeSection = document.getElementById('purposeSection');
      const attendeesSection = document.getElementById('attendeesSection');
      
      if (booking.facility === 'hall') {
        purposeSection.style.display = 'flex';
        attendeesSection.style.display = 'flex';
        
        const purposeText = booking.purpose || window.i18n('booking.detail.no_purpose');
        document.getElementById('bookingPurpose').textContent = purposeText;
        
        if (booking.attendees) {
          const peopleUnit = window.i18n('booking.detail.people');
          document.getElementById('bookingAttendees').textContent = `${booking.attendees}${peopleUnit}`;
        } else {
          document.getElementById('bookingAttendees').textContent = window.i18n('booking.detail.no_purpose');
        }
      } else {
        purposeSection.style.display = 'none';
        attendeesSection.style.display = 'none';
      }

      // ステータス
      const statusKey = `booking.status.${booking.status}`;
      const statusText = window.i18n(statusKey);
      const statusEl = document.getElementById('bookingStatus');
      statusEl.textContent = statusText;
      
      if (booking.status === 'active') {
        statusEl.className = 'text-lg font-bold text-green-600';
      } else if (booking.status === 'cancelled') {
        statusEl.className = 'text-lg font-bold text-red-600';
      } else {
        statusEl.className = 'text-lg font-bold text-gray-600';
      }

      // 予約日時
      document.getElementById('bookingCreated').textContent = booking.createdAt.replace(/-/g, '/');

      // アクションボタンの表示/非表示
      const actionButtons = document.getElementById('actionButtons');
      if (booking.status === 'active') {
        actionButtons.style.display = 'block';
      } else {
        actionButtons.style.display = 'none';
      }
    }

    // 予約を編集
    function editBooking() {
      window.location.href = `booking-edit.html?id=${currentBookingId}`;
    }

    // 予約をキャンセル
    function cancelBooking() {
      const confirmMessage = window.i18n('booking.detail.cancel_confirm');
      if (!confirm(confirmMessage)) {
        return;
      }

      const bookingsJson = localStorage.getItem('bookings');
      if (!bookingsJson) return;

      const bookings = JSON.parse(bookingsJson);
      const booking = bookings.find(b => b.id === currentBookingId);
      
      if (booking) {
        booking.status = 'cancelled';
        localStorage.setItem('bookings', JSON.stringify(bookings));
        
        const successMessage = window.i18n('booking.detail.cancel_success');
        alert(successMessage);
        
        window.location.href = 'booking-history.html';
      }
    }

    // DOM読み込み完了時
    document.addEventListener('DOMContentLoaded', function() {
      window.languageManager.init();
      window.languageManager.updatePage();
      window.languageManager.updateLanguageButtons();
      
      window.languageManager.dynamicHooks.push(renderBookingDetail);
      
      renderBookingDetail();
    });
  </script>
</body>
</html>
