<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–°è¦æŠ•ç¨¿ - ã‚»ã‚­ãƒ¥ãƒ¬ã‚¢ã‚·ãƒ†ã‚£</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/custom.css">
  <!-- ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ -->
  <script src="data/file-utils.js"></script>
  <!-- ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆ -->
  <script src="data/demo-mode.js"></script>
  
  <style>
    /* è¨€èªåˆ‡æ›¿ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .language-switcher {
      display: flex;
      gap: 0;
      border-radius: 8px;
      overflow: hidden;
      background: white;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .lang-btn {
      padding: 8px 16px;
      background: white;
      color: #4B5563;
      border: none;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s;
      border-right: 1px solid #E5E7EB;
    }
    
    .lang-btn:last-child {
      border-right: none;
    }
    
    .lang-btn:hover {
      background: #F3F4F6;
    }
    
    .lang-btn.active {
      background: #2563EB;
      color: white;
    }

    /* é«˜ã•è‡ªå‹•èª¿æ•´ï¼ˆæœ€å¤§é«˜ã‚’åˆ¶é™ï¼‰ */
    textarea {
      min-height: 120px;
      max-height: 300px;
    }

    /* ç®¡ç†è€…å°‚ç”¨ã‚¿ã‚°ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .admin-tag-hidden {
      display: none;
    }
  </style>
  
  <script>
    window.i18nData = {
      ja: {
        'board.new.title': 'æ–°è¦æŠ•ç¨¿',
        'board.new.page_title': 'æ–°è¦æŠ•ç¨¿',
        'board.new.post_title': 'æŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«',
        'board.new.title_placeholder': 'ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
        'board.new.category': 'ã‚«ãƒ†ã‚´ãƒª',
        'board.new.category_select': 'ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ',
        'board.new.content': 'æœ¬æ–‡',
        'board.new.content_placeholder': 'æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„...',
        'board.new.tags': 'ã‚¿ã‚°',
        'board.new.tags_general': 'ä¸€èˆ¬ã‚¿ã‚°ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰',
        'board.new.tags_official': 'ç®¡ç†è€…å°‚ç”¨ã‚¿ã‚°ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰',
        'board.new.tag_consultation': 'ç›¸è«‡',
        'board.new.tag_question': 'è³ªå•',
        'board.new.tag_sharing': 'å…±æœ‰',
        'board.new.tag_suggestion': 'ææ¡ˆ',
        'board.new.tag_circular': 'å›è¦§æ¿',
        'board.new.tag_important': 'é‡è¦',
        'board.new.tag_official': 'å…¬å¼',
        'board.new.files': 'ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜',
        'board.new.files_hint': 'ç”»åƒãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜ã§ãã¾ã™ï¼ˆæœ€å¤§5ãƒ•ã‚¡ã‚¤ãƒ«ã€1ãƒ•ã‚¡ã‚¤ãƒ«5MBä»¥å†…ï¼‰',
        'board.new.anonymous': 'åŒ¿åã§æŠ•ç¨¿',
        'board.new.cancel': 'ã‚­ãƒ£ãƒ³ã‚»ãƒ«',
        'board.new.preview': 'ç¢ºèªç”»é¢ã¸',
        'board.new.submit': 'æŠ•ç¨¿ã™ã‚‹',
        'board.category.noise': 'é¨’éŸ³',
        'board.category.parking': 'é§è»Š',
        'board.category.pet': 'ãƒšãƒƒãƒˆ',
        'board.category.other': 'ãã®ä»–',
        'alert.fill_required': 'ã‚¿ã‚¤ãƒˆãƒ«ã€ã‚«ãƒ†ã‚´ãƒªã€æœ¬æ–‡ã¯å¿…é ˆã§ã™',
        'alert.posted': 'æŠ•ç¨¿ã—ã¾ã—ãŸï¼ (ãƒ‡ãƒ¢)',
        'alert.file_count_exceeded': 'ãƒ•ã‚¡ã‚¤ãƒ«ã¯æœ€å¤§5å€‹ã¾ã§æ·»ä»˜ã§ãã¾ã™',
        'alert.file_size_exceeded': 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯1ãƒ•ã‚¡ã‚¤ãƒ«ã‚ãŸã‚Š5MBä»¥å†…ã«ã—ã¦ãã ã•ã„',
        'common.char_unit': 'æ–‡å­—',
        'common.download': 'ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰'
      },
      en: {
        'board.new.title': 'New Post',
        'board.new.page_title': 'New Post',
        'board.new.post_title': 'Post Title',
        'board.new.title_placeholder': 'Enter title',
        'board.new.category': 'Category',
        'board.new.category_select': 'Select category',
        'board.new.content': 'Content',
        'board.new.content_placeholder': 'Enter content...',
        'board.new.tags': 'Tags',
        'board.new.tags_general': 'General Tags (multiple selection)',
        'board.new.tags_official': 'Admin Only Tags (multiple selection)',
        'board.new.tag_consultation': 'Consultation',
        'board.new.tag_question': 'Question',
        'board.new.tag_sharing': 'Sharing',
        'board.new.tag_suggestion': 'Suggestion',
        'board.new.tag_circular': 'Circular',
        'board.new.tag_important': 'Important',
        'board.new.tag_official': 'Official',
        'board.new.files': 'Attach Files',
        'board.new.files_hint': 'You can attach images and documents (Max 5 files, 5MB per file)',
        'board.new.anonymous': 'Post anonymously',
        'board.new.cancel': 'Cancel',
        'board.new.preview': 'Preview',
        'board.new.submit': 'Post',
        'board.category.noise': 'Noise',
        'board.category.parking': 'Parking',
        'board.category.pet': 'Pet',
        'board.category.other': 'Other',
        'alert.fill_required': 'Title, category, and content are required',
        'alert.posted': 'Posted! (Demo)',
        'alert.file_count_exceeded': 'You can attach up to 5 files',
        'alert.file_size_exceeded': 'File size must be within 5MB per file',
        'common.char_unit': 'chars',
        'common.download': 'Download'
      },
      zh: {
        'board.new.title': 'æ–°å‘å¸–',
        'board.new.page_title': 'æ–°å‘å¸–',
        'board.new.post_title': 'å¸–å­æ ‡é¢˜',
        'board.new.title_placeholder': 'è¯·è¾“å…¥æ ‡é¢˜',
        'board.new.category': 'ç±»åˆ«',
        'board.new.category_select': 'é€‰æ‹©ç±»åˆ«',
        'board.new.content': 'æ­£æ–‡',
        'board.new.content_placeholder': 'è¯·è¾“å…¥æ­£æ–‡...',
        'board.new.tags': 'æ ‡ç­¾',
        'board.new.tags_general': 'æ™®é€šæ ‡ç­¾ï¼ˆå¯å¤šé€‰ï¼‰',
        'board.new.tags_official': 'ç®¡ç†å‘˜ä¸“ç”¨æ ‡ç­¾ï¼ˆå¯å¤šé€‰ï¼‰',
        'board.new.tag_consultation': 'å’¨è¯¢',
        'board.new.tag_question': 'é—®é¢˜',
        'board.new.tag_sharing': 'å…±äº«',
        'board.new.tag_suggestion': 'å»ºè®®',
        'board.new.tag_circular': 'ä¼ é˜…é€šçŸ¥',
        'board.new.tag_important': 'é‡è¦',
        'board.new.tag_official': 'å®˜æ–¹',
        'board.new.files': 'é™„ä»¶',
        'board.new.files_hint': 'å¯ä»¥æ·»åŠ å›¾ç‰‡å’Œæ–‡æ¡£ï¼ˆæœ€å¤š5ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶5MBä»¥å†…ï¼‰',
        'board.new.anonymous': 'åŒ¿åå‘å¸–',
        'board.new.cancel': 'å–æ¶ˆ',
        'board.new.preview': 'é¢„è§ˆ',
        'board.new.submit': 'å‘å¸–',
        'board.category.noise': 'å™ªéŸ³',
        'board.category.parking': 'åœè½¦',
        'board.category.pet': 'å® ç‰©',
        'board.category.other': 'å…¶ä»–',
        'alert.fill_required': 'æ ‡é¢˜ã€ç±»åˆ«å’Œæ­£æ–‡ä¸ºå¿…å¡«é¡¹',
        'alert.posted': 'å·²å‘å¸–ï¼ï¼ˆæ¼”ç¤ºï¼‰',
        'alert.file_count_exceeded': 'æœ€å¤šå¯ä»¥æ·»åŠ 5ä¸ªæ–‡ä»¶',
        'alert.file_size_exceeded': 'æ¯ä¸ªæ–‡ä»¶å¤§å°å¿…é¡»åœ¨5MBä»¥å†…',
        'common.char_unit': 'å­—ç¬¦',
        'common.download': 'ä¸‹è½½'
      }
    };
  </script>
</head>
<body class="bg-gray-50">
  
  <!-- è¨€èªåˆ‡æ›¿ãƒœã‚¿ãƒ³ï¼ˆå³ä¸Šå›ºå®šï¼‰ -->
  <div class="fixed top-4 right-4 language-switcher z-50 shadow-lg">
    <button class="lang-btn active" data-lang="ja">JA</button>
    <button class="lang-btn" data-lang="en">EN</button>
    <button class="lang-btn" data-lang="zh">ZH</button>
  </div>

  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="bg-white shadow-sm">
    <div class="max-w-4xl mx-auto px-4 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <button onclick="window.location.href='board.html'" class="text-gray-600 hover:text-gray-900">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
          </button>
          <h1 class="text-xl font-bold text-gray-900" data-i18n="board.new.page_title">æ–°è¦æŠ•ç¨¿</h1>
        </div>
      </div>
    </div>
  </header>

  <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
  <main class="max-w-4xl mx-auto px-4 py-6">
    <form id="postForm" class="bg-white rounded-lg shadow-md p-6 space-y-6">
      
      <!-- ã‚¿ã‚¤ãƒˆãƒ« -->
      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2" data-i18n="board.new.post_title">æŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«</label>
        <input 
          type="text" 
          id="postTitle"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          placeholder="ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
          data-i18n-placeholder="board.new.title_placeholder"
          maxlength="100"
        >
        <div class="text-right text-sm text-gray-500 mt-1">
          <span id="titleCharCount">0</span> / 100 <span data-i18n="common.char_unit">æ–‡å­—</span>
        </div>
      </div>

      <!-- ã‚«ãƒ†ã‚´ãƒª -->
      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2" data-i18n="board.new.category">ã‚«ãƒ†ã‚´ãƒª</label>
        <select 
          id="postCategory"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        >
          <option value="" data-i18n="board.new.category_select">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ</option>
          <option value="noise" data-i18n="board.category.noise">é¨’éŸ³</option>
          <option value="parking" data-i18n="board.category.parking">é§è»Š</option>
          <option value="pet" data-i18n="board.category.pet">ãƒšãƒƒãƒˆ</option>
          <option value="other" data-i18n="board.category.other">ãã®ä»–</option>
        </select>
      </div>

      <!-- æœ¬æ–‡ -->
      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2" data-i18n="board.new.content">æœ¬æ–‡</label>
        <textarea 
          id="postContent"
          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
          placeholder="æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..."
          data-i18n-placeholder="board.new.content_placeholder"
          rows="8"
          maxlength="2000"
        ></textarea>
        <div class="text-right text-sm text-gray-500 mt-1">
          <span id="contentCharCount">0</span> / 2000 <span data-i18n="common.char_unit">æ–‡å­—</span>
        </div>
      </div>

      <!-- ã‚¿ã‚° -->
      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2" data-i18n="board.new.tags">ã‚¿ã‚°</label>
        
        <!-- ä¸€èˆ¬ã‚¿ã‚° -->
        <div class="mb-4">
          <p class="text-sm text-gray-600 mb-2" data-i18n="board.new.tags_general">ä¸€èˆ¬ã‚¿ã‚°ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</p>
          <div class="flex flex-wrap gap-2">
            <label class="inline-flex items-center cursor-pointer">
              <input type="checkbox" name="generalTags" value="ç›¸è«‡" class="form-checkbox h-5 w-5 text-blue-600">
              <span class="ml-2 text-sm" data-i18n="board.new.tag_consultation">ç›¸è«‡</span>
            </label>
            <label class="inline-flex items-center cursor-pointer">
              <input type="checkbox" name="generalTags" value="è³ªå•" class="form-checkbox h-5 w-5 text-blue-600">
              <span class="ml-2 text-sm" data-i18n="board.new.tag_question">è³ªå•</span>
            </label>
            <label class="inline-flex items-center cursor-pointer">
              <input type="checkbox" name="generalTags" value="å…±æœ‰" class="form-checkbox h-5 w-5 text-blue-600">
              <span class="ml-2 text-sm" data-i18n="board.new.tag_sharing">å…±æœ‰</span>
            </label>
            <label class="inline-flex items-center cursor-pointer">
              <input type="checkbox" name="generalTags" value="ææ¡ˆ" class="form-checkbox h-5 w-5 text-blue-600">
              <span class="ml-2 text-sm" data-i18n="board.new.tag_suggestion">ææ¡ˆ</span>
            </label>
          </div>
        </div>

        <!-- ç®¡ç†è€…å°‚ç”¨ã‚¿ã‚° -->
        <div id="adminTagsSection" class="admin-tag-hidden">
          <p class="text-sm text-red-600 font-bold mb-2" data-i18n="board.new.tags_official">ç®¡ç†è€…å°‚ç”¨ã‚¿ã‚°ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</p>
          <div class="flex flex-wrap gap-2">
            <label class="inline-flex items-center cursor-pointer">
              <input type="checkbox" name="officialTags" value="å›è¦§æ¿" class="form-checkbox h-5 w-5 text-red-600">
              <span class="ml-2 text-sm font-bold text-red-600" data-i18n="board.new.tag_circular">ğŸ”´ å›è¦§æ¿</span>
            </label>
            <label class="inline-flex items-center cursor-pointer">
              <input type="checkbox" name="officialTags" value="é‡è¦" class="form-checkbox h-5 w-5 text-blue-600">
              <span class="ml-2 text-sm font-bold text-blue-600" data-i18n="board.new.tag_important">ğŸ”µ é‡è¦</span>
            </label>
            <label class="inline-flex items-center cursor-pointer">
              <input type="checkbox" name="officialTags" value="å…¬å¼" class="form-checkbox h-5 w-5 text-green-600">
              <span class="ml-2 text-sm font-bold text-green-600" data-i18n="board.new.tag_official">ğŸŸ¢ å…¬å¼</span>
            </label>
          </div>
        </div>
      </div>

      <!-- ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜ -->
      <div>
        <label class="block text-sm font-bold text-gray-700 mb-2" data-i18n="board.new.files">ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜</label>
        <p class="text-sm text-gray-600 mb-2" data-i18n="board.new.files_hint">ç”»åƒãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜ã§ãã¾ã™ï¼ˆè¤‡æ•°å¯ï¼‰</p>
        <input 
          type="file" 
          id="fileInput"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
          multiple
          accept="image/*,.pdf,.doc,.docx,.xls,.xlsx,.zip,.txt"
        >
        <div id="filePreview" class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4"></div>
      </div>

      <!-- åŒ¿åæŠ•ç¨¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
      <div class="flex items-center">
        <input 
          type="checkbox" 
          id="anonymousPost"
          class="form-checkbox h-5 w-5 text-blue-600"
        >
        <label for="anonymousPost" class="ml-2 text-sm text-gray-700" data-i18n="board.new.anonymous">åŒ¿åã§æŠ•ç¨¿</label>
      </div>

      <!-- ãƒœã‚¿ãƒ³ -->
      <div class="flex gap-3 pt-4">
        <button 
          type="button"
          onclick="window.location.href='board.html'"
          class="flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg font-bold hover:bg-gray-50 transition-colors"
        >
          <span data-i18n="board.new.cancel">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</span>
        </button>
        <button 
          type="submit"
          class="flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition-colors"
        >
          <span data-i18n="board.new.submit">æŠ•ç¨¿ã™ã‚‹</span>
        </button>
      </div>
    </form>
  </main>

  <script>
    // ç°¡æ˜“å¤šè¨€èªãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
    class EmbeddedLanguageManager {
      constructor() {
        this.currentLang = localStorage.getItem('language') || 'ja';
        this.init();
      }

      init() {
        // è¨€èªãƒœã‚¿ãƒ³ã®åˆæœŸåŒ–
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.dataset.lang === this.currentLang) {
            btn.classList.add('active');
          }
          
          btn.addEventListener('click', () => {
            this.setLanguage(btn.dataset.lang);
          });
        });

        // åˆæœŸç¿»è¨³
        this.translatePage();
      }

      setLanguage(lang) {
        this.currentLang = lang;
        localStorage.setItem('language', lang);
        
        // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.classList.remove('active');
          if (btn.dataset.lang === lang) {
            btn.classList.add('active');
          }
        });

        this.translatePage();
      }

      translate(key) {
        return window.i18nData[this.currentLang]?.[key] || key;
      }

      translatePage() {
        // data-i18nå±æ€§ã‚’æŒã¤è¦ç´ ã‚’ç¿»è¨³
        document.querySelectorAll('[data-i18n]').forEach(element => {
          const key = element.getAttribute('data-i18n');
          element.textContent = this.translate(key);
        });

        // placeholderå±æ€§ã®ç¿»è¨³
        document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
          const key = element.getAttribute('data-i18n-placeholder');
          element.placeholder = this.translate(key);
        });
      }
    }

    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
    function updateCharCount(element, countElement, maxLength) {
      const count = element.value.length;
      countElement.textContent = count;
      
      if (count > maxLength * 0.9) {
        countElement.classList.add('text-red-600');
      } else {
        countElement.classList.remove('text-red-600');
      }
    }

    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
    function handleFileSelect(event) {
      const files = Array.from(event.target.files);
      const preview = document.getElementById('filePreview');
      
      // ãƒ•ã‚¡ã‚¤ãƒ«æ•°ãƒã‚§ãƒƒã‚¯ï¼ˆæœ€å¤§5ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰
      if (files.length > 5) {
        const alertText = window.i18n ? window.i18n.translate('alert.file_count_exceeded') : 'ãƒ•ã‚¡ã‚¤ãƒ«ã¯æœ€å¤§5å€‹ã¾ã§æ·»ä»˜ã§ãã¾ã™';
        alert(alertText);
        event.target.value = ''; // å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
        return;
      }
      
      // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯ï¼ˆ1ãƒ•ã‚¡ã‚¤ãƒ«5MBä»¥å†…ï¼‰
      const maxSize = 5 * 1024 * 1024; // 5MB
      const oversizedFiles = files.filter(file => file.size > maxSize);
      if (oversizedFiles.length > 0) {
        const alertText = window.i18n ? window.i18n.translate('alert.file_size_exceeded') : 'ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯1ãƒ•ã‚¡ã‚¤ãƒ«ã‚ãŸã‚Š5MBä»¥å†…ã«ã—ã¦ãã ã•ã„';
        alert(alertText + '\n\n' + oversizedFiles.map(f => `${f.name}: ${(f.size / 1024 / 1024).toFixed(2)}MB`).join('\n'));
        event.target.value = ''; // å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
        return;
      }
      
      preview.innerHTML = '';

      files.forEach((file, index) => {
        const fileItem = document.createElement('div');
        const fileName = file.name;
        const fileSize = (file.size / 1024).toFixed(1) + ' KB';
        
        // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
        if (file.type.startsWith('image/')) {
          fileItem.className = 'relative border border-gray-300 rounded-lg overflow-hidden';
          
          const reader = new FileReader();
          reader.onload = function(e) {
            fileItem.innerHTML = `
              <img src="${e.target.result}" alt="${fileName}" class="w-full h-48 object-cover">
              <div class="absolute top-2 right-2">
                <button 
                  type="button"
                  onclick="removeFile(${index})"
                  class="bg-red-600 text-white p-2 rounded-full hover:bg-red-700 shadow-lg"
                  title="å‰Šé™¤"
                >
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                  </svg>
                </button>
              </div>
              <div class="p-3 bg-gray-50">
                <p class="text-sm font-medium text-gray-900 truncate">${fileName}</p>
                <p class="text-xs text-gray-500">${fileSize}</p>
              </div>
            `;
          };
          reader.readAsDataURL(file);
        } else {
          // ãã®ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å ´åˆ
          fileItem.className = 'flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-300';
          const fileIcon = getFileIcon(file.type);
          
          fileItem.innerHTML = `
            <span class="text-2xl">${fileIcon}</span>
            <div class="flex-1">
              <p class="text-sm font-medium text-gray-900">${fileName}</p>
              <p class="text-xs text-gray-500">${fileSize}</p>
            </div>
            <button 
              type="button"
              onclick="removeFile(${index})"
              class="text-red-600 hover:text-red-800"
            >
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          `;
        }
        
        preview.appendChild(fileItem);
      });
    }

    function getFileIcon(mimeType) {
      if (mimeType.startsWith('image/')) return 'ğŸ–¼ï¸';
      if (mimeType === 'application/pdf') return 'ğŸ“„';
      if (mimeType.includes('word')) return 'ğŸ“';
      if (mimeType.includes('excel') || mimeType.includes('spreadsheet')) return 'ğŸ“Š';
      if (mimeType.includes('zip')) return 'ğŸ“¦';
      return 'ğŸ“';
    }

    function removeFile(index) {
      const fileInput = document.getElementById('fileInput');
      const dt = new DataTransfer();
      const files = Array.from(fileInput.files);
      
      files.forEach((file, i) => {
        if (i !== index) dt.items.add(file);
      });
      
      fileInput.files = dt.files;
      handleFileSelect({ target: fileInput });
    }

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    function handleSubmit(event) {
      event.preventDefault();
      
      const title = document.getElementById('postTitle').value.trim();
      const category = document.getElementById('postCategory').value;
      const content = document.getElementById('postContent').value.trim();
      
      if (!title || !category || !content) {
        const alertText = window.i18n ? window.i18n.translate('alert.fill_required') : 'ã‚¿ã‚¤ãƒˆãƒ«ã€ã‚«ãƒ†ã‚´ãƒªã€æœ¬æ–‡ã¯å¿…é ˆã§ã™';
        alert(alertText);
        return;
      }
      
      const postedText = window.i18n ? window.i18n.translate('alert.posted') : 'æŠ•ç¨¿ã—ã¾ã—ãŸï¼ (ãƒ‡ãƒ¢)';
      alert(postedText);
      window.location.href = 'board.html';
    }

    // åˆæœŸåŒ–
    document.addEventListener('DOMContentLoaded', function() {
      // å¤šè¨€èªãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®åˆæœŸåŒ–
      window.i18n = new EmbeddedLanguageManager();
      
      // ãƒ‡ãƒ¢ãƒ¢ãƒ¼ãƒ‰ã®åˆæœŸåŒ–
      if (typeof initDemoMode === 'function') {
        initDemoMode();
      }
      const currentUser = typeof getDemoUser === 'function' ? getDemoUser() : { id: 'guest', isAdmin: false };
      
      // ç®¡ç†è€…å°‚ç”¨ã‚¿ã‚°ã®è¡¨ç¤º/éè¡¨ç¤º
      if (currentUser.isAdmin) {
        document.getElementById('adminTagsSection').classList.remove('admin-tag-hidden');
      }
      
      // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
      document.getElementById('postTitle').addEventListener('input', function() {
        updateCharCount(this, document.getElementById('titleCharCount'), 100);
      });
      
      document.getElementById('postContent').addEventListener('input', function() {
        updateCharCount(this, document.getElementById('contentCharCount'), 2000);
      });
      
      document.getElementById('fileInput').addEventListener('change', handleFileSelect);
      
      document.getElementById('postForm').addEventListener('submit', handleSubmit);
    });
  </script>

</body>
</html>
