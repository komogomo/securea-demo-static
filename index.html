<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒ­ã‚°ã‚¤ãƒ³ - ã‚»ã‚­ãƒ¥ãƒ¬ã‚¢ã‚·ãƒ†ã‚£</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="css/custom.css">
  
  <!-- å¤šè¨€èªãƒ‡ãƒ¼ã‚¿ -->
  <script>
    window.i18nData = {
      ja: {
        'login.title': 'ãƒ­ã‚°ã‚¤ãƒ³',
        'login.site.title': 'SECUREA City ã¤ãã°ç ”ç©¶å­¦åœ’',
        'login.site.subtitle': 'å…¥å±…è€…å°‚ç”¨Webã‚µã‚¤ãƒˆ',
        'login.app.title': 'ä½ã¾ã„ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚¢ãƒ—ãƒª',
        'login.email': 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹',
        'login.email.placeholder': 'example@email.com',
        'login.button': 'ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯ã‚’é€ä¿¡',
        'login.demo': 'ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ',
        'login.demo.text': 'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: demo@securea-city.jp',
        'login.info.screens': 'ã“ã®ãƒ‡ãƒ¢ã¯å…¨15ç”»é¢ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™',
        'login.info.language': 'ğŸŒ å³ä¸Šã®ãƒœã‚¿ãƒ³ã§è¨€èªã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™',
        'login.sent.title': 'ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ',
        'login.sent.message': 'å…¥åŠ›ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å®›ã«ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚',
        'login.sent.check': 'ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚',
        'login.sent.demo': 'ãƒ‡ãƒ¢ï¼šä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã§ãã¾ã™',
        'login.sent.demo.button': 'ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆãƒ‡ãƒ¢ï¼‰',
        'login.sent.note': 'â€» å®Ÿéš›ã®ç’°å¢ƒã§ã¯ã€ãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™',
        'login.sent.resend': 'å†é€ä¿¡ã™ã‚‹',
        'login.error.invalid': 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“'
      },
      en: {
        'login.title': 'Login',
        'login.site.title': 'SECUREA City Tsukuba Kenkyugakuen',
        'login.site.subtitle': 'Resident Portal',
        'login.app.title': 'Community Living App',
        'login.email': 'Email Address',
        'login.email.placeholder': 'example@email.com',
        'login.button': 'Send Login Link',
        'login.demo': 'Demo Account',
        'login.demo.text': 'Email: demo@securea-city.jp',
        'login.info.screens': 'This demo consists of 15 screens',
        'login.info.language': 'ğŸŒ Switch language with buttons above',
        'login.sent.title': 'Email Sent',
        'login.sent.message': 'We have sent a login link to the email address you entered.',
        'login.sent.check': 'Please check your inbox.',
        'login.sent.demo': 'Demo: Click the button below to simulate login',
        'login.sent.demo.button': 'Click Magic Link (Demo)',
        'login.sent.note': '* In production, you would click the link in your email to login',
        'login.sent.resend': 'Resend',
        'login.error.invalid': 'This email address is not registered'
      },
      zh: {
        'login.title': 'ç™»å½•',
        'login.site.title': 'SECUREA City ç­‘æ³¢ç ”ç©¶å­¦å›­',
        'login.site.subtitle': 'ä½æˆ·ä¸“ç”¨ç½‘ç«™',
        'login.app.title': 'å±…ä½ç¤¾åŒºåº”ç”¨',
        'login.email': 'ç”µå­é‚®ä»¶åœ°å€',
        'login.email.placeholder': 'example@email.com',
        'login.button': 'å‘é€ç™»å½•é“¾æ¥',
        'login.demo': 'æ¼”ç¤ºè´¦æˆ·',
        'login.demo.text': 'ç”µå­é‚®ä»¶: demo@securea-city.jp',
        'login.info.screens': 'æ­¤æ¼”ç¤ºç”±15ä¸ªç•Œé¢ç»„æˆ',
        'login.info.language': 'ğŸŒ ä½¿ç”¨ä¸Šæ–¹æŒ‰é’®åˆ‡æ¢è¯­è¨€',
        'login.sent.title': 'ç”µå­é‚®ä»¶å·²å‘é€',
        'login.sent.message': 'æˆ‘ä»¬å·²å‘æ‚¨è¾“å…¥çš„ç”µå­é‚®ä»¶åœ°å€å‘é€äº†ç™»å½•é“¾æ¥ã€‚',
        'login.sent.check': 'è¯·æ£€æŸ¥æ‚¨çš„æ”¶ä»¶ç®±ã€‚',
        'login.sent.demo': 'æ¼”ç¤ºï¼šç‚¹å‡»ä¸‹æ–¹æŒ‰é’®æ¨¡æ‹Ÿç™»å½•',
        'login.sent.demo.button': 'ç‚¹å‡»é­”æ³•é“¾æ¥ï¼ˆæ¼”ç¤ºï¼‰',
        'login.sent.note': '* åœ¨å®é™…ç¯å¢ƒä¸­ï¼Œæ‚¨éœ€è¦ç‚¹å‡»ç”µå­é‚®ä»¶ä¸­çš„é“¾æ¥è¿›è¡Œç™»å½•',
        'login.sent.resend': 'é‡æ–°å‘é€',
        'login.error.invalid': 'æ­¤ç”µå­é‚®ä»¶åœ°å€æœªæ³¨å†Œ'
      }
    };
    
    console.log('âœ… i18nData embedded successfully');
    console.log('Available languages:', Object.keys(window.i18nData));
  </script>
</head>
<body class="bg-gray-50">
  <!-- è¨€èªåˆ‡æ›¿ãƒœã‚¿ãƒ³ -->
  <div class="fixed top-4 right-4 language-switcher z-50 shadow-lg">
    <button class="lang-btn" data-lang="ja">JA</button>
    <button class="lang-btn" data-lang="en">EN</button>
    <button class="lang-btn" data-lang="zh">ZH</button>
  </div>

  <div class="min-h-screen flex items-center justify-center p-4">
    <div class="max-w-md w-full">
      <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
      <div class="text-center mb-8 fade-in">
        <h1 class="text-3xl font-bold text-gray-900 mb-2" data-i18n="login.site.title">
          SECUREA City ã¤ãã°ç ”ç©¶å­¦åœ’
        </h1>
        <p class="text-gray-600" data-i18n="login.site.subtitle">å…¥å±…è€…å°‚ç”¨Webã‚µã‚¤ãƒˆ</p>
        <h2 class="text-2xl font-bold text-blue-600 mt-4" data-i18n="login.app.title">
          ä½ã¾ã„ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‚¢ãƒ—ãƒª
        </h2>
      </div>

      <!-- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å…¥åŠ›ç”»é¢ -->
      <div id="loginForm" class="bg-white rounded-lg shadow-lg p-8 fade-in">
        <h3 class="text-xl font-bold text-gray-900 mb-6 text-center" data-i18n="login.title">
          ãƒ­ã‚°ã‚¤ãƒ³
        </h3>

        <form onsubmit="handleMagicLinkRequest(event)">
          <div class="mb-6">
            <label class="block text-sm font-bold text-gray-700 mb-2" data-i18n="login.email">
              ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
            </label>
            <input 
              type="email" 
              id="email"
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="example@email.com"
              data-i18n-placeholder="login.email.placeholder"
              value="demo@securea-city.jp"
              required
            >
          </div>

          <button 
            type="submit"
            class="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition"
          >
            <span data-i18n="login.button">ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯ã‚’é€ä¿¡</span>
          </button>
        </form>

        <!-- ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ± -->
        <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
          <p class="text-sm text-blue-900">
            <span class="font-bold" data-i18n="login.demo">ãƒ‡ãƒ¢ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</span><br>
            <span data-i18n="login.demo.text">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹: demo@securea-city.jp</span>
          </p>
        </div>
      </div>

      <!-- ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†ç”»é¢ï¼ˆæœ€åˆã¯éè¡¨ç¤ºï¼‰ -->
      <div id="emailSent" class="bg-white rounded-lg shadow-lg p-8 fade-in" style="display: none;">
        <div class="text-center mb-6">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
            <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
          </div>
          <h3 class="text-xl font-bold text-gray-900 mb-2" data-i18n="login.sent.title">
            ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸ
          </h3>
          <p class="text-gray-600 mb-2" data-i18n="login.sent.message">
            å…¥åŠ›ã•ã‚ŒãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹å®›ã«ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚
          </p>
          <p class="text-gray-600 font-medium" data-i18n="login.sent.check">
            ãƒ¡ãƒ¼ãƒ«ãƒœãƒƒã‚¯ã‚¹ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
          </p>
        </div>

        <div class="mb-4">
          <p class="text-sm text-gray-500 text-center mb-1">
            <span data-i18n="login.sent.demo">ãƒ‡ãƒ¢ï¼šä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã§ãã¾ã™</span>
          </p>
        </div>

        <!-- ãƒ‡ãƒ¢ç”¨ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ãƒœã‚¿ãƒ³ -->
        <button 
          onclick="simulateMagicLink()"
          class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-4 rounded-lg font-bold hover:from-purple-700 hover:to-blue-700 transition shadow-lg mb-4"
        >
          <span data-i18n="login.sent.demo.button">âœ‰ï¸ ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼ˆãƒ‡ãƒ¢ï¼‰</span>
        </button>

        <p class="text-xs text-gray-500 text-center mb-4" data-i18n="login.sent.note">
          â€» å®Ÿéš›ã®ç’°å¢ƒã§ã¯ã€ãƒ¡ãƒ¼ãƒ«å†…ã®ãƒªãƒ³ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™
        </p>

        <!-- å†é€ä¿¡ãƒœã‚¿ãƒ³ -->
        <button 
          onclick="backToLogin()"
          class="w-full border border-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-50 transition"
        >
          <span data-i18n="login.sent.resend">â† å†é€ä¿¡ã™ã‚‹</span>
        </button>
      </div>

      <!-- ç”»é¢æƒ…å ± -->
      <div class="mt-6 text-center text-sm text-gray-600">
        <p data-i18n="login.info.screens">ã“ã®ãƒ‡ãƒ¢ã¯å…¨15ç”»é¢ã§æ§‹æˆã•ã‚Œã¦ã„ã¾ã™</p>
        <p class="mt-1" data-i18n="login.info.language">ğŸŒ å³ä¸Šã®ãƒœã‚¿ãƒ³ã§è¨€èªã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã¾ã™</p>
      </div>
    </div>
  </div>

  <!-- JavaScriptã‚³ãƒ¼ãƒ‰ -->
  <script>
    console.log('=== ç¿»è¨³ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹ ===');
    
    // ç¿»è¨³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚¯ãƒ©ã‚¹
    class EmbeddedLanguageManager {
      constructor() {
        console.log('EmbeddedLanguageManager constructor');
        this.currentLanguage = localStorage.getItem('language') || 'ja';
        this.translations = window.i18nData;
        console.log('âœ… Translations loaded:', Object.keys(this.translations));
        console.log('âœ… Current language:', this.currentLanguage);
      }
      
      setLanguage(lang) {
        console.log('ğŸ”„ Changing language to:', lang);
        if (this.translations[lang]) {
          this.currentLanguage = lang;
          localStorage.setItem('language', lang);
          this.updatePage();
          this.updateLanguageButtons();
          console.log('âœ… Language changed successfully');
        } else {
          console.error('âŒ Translation not found for:', lang);
        }
      }
      
      translate(key) {
        const translation = this.translations[this.currentLanguage];
        return translation && translation[key] ? translation[key] : key;
      }
      
      updatePage() {
        console.log('ğŸ”„ Updating page translations');
        let count = 0;
        
        // data-i18nå±æ€§ã‚’æŒã¤è¦ç´ ã‚’ç¿»è¨³
        document.querySelectorAll('[data-i18n]').forEach(element => {
          const key = element.getAttribute('data-i18n');
          const translation = this.translate(key);
          
          if (element.children.length === 0) {
            element.textContent = translation;
          } else {
            for (let node of element.childNodes) {
              if (node.nodeType === Node.TEXT_NODE && node.textContent.trim()) {
                node.textContent = translation;
                break;
              }
            }
          }
          count++;
        });
        
        // placeholderå±æ€§ã®ç¿»è¨³
        document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
          const key = element.getAttribute('data-i18n-placeholder');
          element.placeholder = this.translate(key);
        });
        
        console.log('âœ… Translated', count, 'elements');
      }
      
      updateLanguageButtons() {
        document.querySelectorAll('.lang-btn').forEach(btn => {
          const lang = btn.getAttribute('data-lang');
          if (lang === this.currentLanguage) {
            btn.classList.add('active');
            btn.classList.remove('inactive');
          } else {
            btn.classList.remove('active');
            btn.classList.add('inactive');
          }
        });
      }
      
      init() {
        console.log('ğŸ”„ Initializing buttons');
        document.querySelectorAll('.lang-btn').forEach(btn => {
          btn.addEventListener('click', () => {
            const lang = btn.getAttribute('data-lang');
            console.log('ğŸ–±ï¸ Button clicked:', lang);
            this.setLanguage(lang);
          });
        });
        this.updatePage();
        this.updateLanguageButtons();
        console.log('âœ… Initialization complete');
      }
    }
    
    // ãƒ‡ãƒ¢ç”¨ï¼šç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ãƒªã‚¹ãƒˆ
    const registeredEmails = [
      'demo@securea-city.jp',
      'test@securea-city.jp',
      'user@securea-city.jp'
    ];
    
    // ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯é€ä¿¡ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
    function handleMagicLinkRequest(event) {
      event.preventDefault();
      const email = document.getElementById('email').value.trim();
      
      console.log('ğŸ“§ Magic link request for:', email);
      
      // ãƒ‡ãƒ¢ç”¨ï¼šãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®æ¤œè¨¼ï¼ˆå®Ÿéš›ã«ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§è¡Œã†ï¼‰
      // ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®ï¼šå®Ÿéš›ã®ç’°å¢ƒã§ã¯ã€å­˜åœ¨ã—ãªã„ãƒ¡ãƒ¼ãƒ«ã§ã‚‚åŒã˜ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
      if (!registeredEmails.includes(email)) {
        // ãƒ‡ãƒ¢ãªã®ã§ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
        const errorMsg = window.i18n ? window.i18n('login.error.invalid') : 'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“';
        alert(errorMsg);
        return;
      }
      
      // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã‚’éè¡¨ç¤ºã€ãƒ¡ãƒ¼ãƒ«é€ä¿¡å®Œäº†ç”»é¢ã‚’è¡¨ç¤º
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('emailSent').style.display = 'block';
      
      // é€ä¿¡ã—ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä¿å­˜ï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰
      sessionStorage.setItem('loginEmail', email);
      
      console.log('âœ… Email sent screen displayed');
    }
    
    // ãƒã‚¸ãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚¯ãƒªãƒƒã‚¯ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
    function simulateMagicLink() {
      const email = sessionStorage.getItem('loginEmail') || 'demo@securea-city.jp';
      
      console.log('ğŸ”— Simulating magic link click for:', email);
      
      // ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ä¿å­˜
      localStorage.setItem('isLoggedIn', 'true');
      localStorage.setItem('userEmail', email);
      // ãƒ‡ãƒ¢ç”¨ã«éƒ¨å±‹ç•ªå·ã‚‚è¨­å®š
      localStorage.setItem('roomNumber', 'B71');
      
      // ãƒ›ãƒ¼ãƒ ç”»é¢ã¸é·ç§»
      console.log('â¡ï¸ Redirecting to home.html');
      window.location.href = 'home.html';
    }
    
    // ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«æˆ»ã‚‹
    function backToLogin() {
      document.getElementById('emailSent').style.display = 'none';
      document.getElementById('loginForm').style.display = 'block';
      sessionStorage.removeItem('loginEmail');
    }
    
    // DOMãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã‚‰å®Ÿè¡Œ
    document.addEventListener('DOMContentLoaded', function() {
      console.log('=== DOMContentLoaded ===');
      
      if (!window.i18nData) {
        console.error('âŒ CRITICAL: i18nData not found!');
        alert('ç¿»è¨³ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
        return;
      }
      
      window.languageManager = new EmbeddedLanguageManager();
      window.languageManager.init();
      
      window.i18n = function(key) {
        return window.languageManager.translate(key);
      };
      
      console.log('=== ç¿»è¨³ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº† ===');
    });
  </script>
</body>
</html>
